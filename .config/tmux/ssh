#!/usr/bin/env bash

ssh_sessions=$(tmux list-sessions -F "#{session_name}" 2>/dev/null | grep -E "^SSH " || echo "")

display_sessions=$(echo "$ssh_sessions" | sed 's/^SSH //')

result=$(echo "$display_sessions" | fzf --tmux --prompt="ssh: " --print-query | tail -1)

if [ -z "$result" ]; then
    exit 0
fi

session_name="SSH $result"

if tmux has-session -t "$session_name" 2>/dev/null; then
    tmux switch-client -t "$session_name"
else
    tmux new-session -d -s "$session_name" "ssh $result" && tmux switch-client -t "$session_name"
fi
